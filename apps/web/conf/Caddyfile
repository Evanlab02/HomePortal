(inttls) {
	tls /certs/fullchain.cer /certs/labuschagne.xyz.key
}

portal.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-flame:5005 {
			header_up Host portal.labuschagne.xyz
		}
	}
}

jelly.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy http://192.168.50.2:8096 {
			header_up Host jelly.labuschagne.xyz
		}
	}
}

prowlarr.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy http://192.168.50.2:9696 {
			header_up Host prowlarr.labuschagne.xyz
		}
	}
}

sonarr.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy http://192.168.50.2:8989 {
			header_up Host sonarr.labuschagne.xyz
		}
	}
}

radarr.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy http://192.168.50.2:7878 {
			header_up Host radarr.labuschagne.xyz
		}
	}
}

torrent.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-gluetun:8080 {
			header_up Host torrent.labuschagne.xyz
		}
	}
}

budget.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-actual-server:5006 {
			header_up Host budget.labuschagne.xyz
		}
	}
}

time.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-solidtime-app:8000 {
			header_up Host time.labuschagne.xyz
		}
	}
}

images.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-immich-server:2283 {
			header_up Host images.labuschagne.xyz
		}
	}
}

immichml.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-immich-ml:3003 {
			header_up Host immichml.labuschagne.xyz
		}
	}
}

shopping.labuschagne.xyz {
	import inttls

	handle_path /docs/* {
		root * /var/www/html/shopping/docs
		file_server
	}

	handle_path /static/* {
		root * /var/www/html/shopping/static
		file_server
	}

	handle /admin/* {
		forward_auth hp-authentik-server:9000 {
			uri /outpost.goauthentik.io/auth/caddy
			copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
			trusted_proxies private_ranges
		}

		reverse_proxy hp-shopping-admin:80 {
			header_up Host shopping.labuschagne.xyz
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	handle {
		forward_auth hp-authentik-server:9000 {
			uri /outpost.goauthentik.io/auth/caddy
			copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
			trusted_proxies private_ranges
		}

		reverse_proxy hp-shopping-app:80 {
			header_up Host shopping.labuschagne.xyz
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}
}

pgadmin.labuschagne.xyz {
	import inttls

	# Bypass auth for static assets
	@static path /static/*
	handle @static {
		reverse_proxy hp-pgadmin:80 {
			header_up Host pgadmin.labuschagne.xyz
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# Auth required for everything else
	handle {
		forward_auth hp-authentik-server:9000 {
			uri /outpost.goauthentik.io/auth/caddy
			copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
			trusted_proxies private_ranges
		}

		reverse_proxy hp-pgadmin:80 {
			header_up Host pgadmin.labuschagne.xyz
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}
}

manage.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-yacht:8000 {
			header_up Host manage.labuschagne.xyz
		}
	}
}

files.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-dufs:5000 {
			header_up Host files.labuschagne.xyz
		}
	}
}

seerr.labuschagne.xyz {
	import inttls

	forward_auth hp-authentik-server:9000 {
		uri /outpost.goauthentik.io/auth/caddy
		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Entitlements X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version
		trusted_proxies private_ranges
	}

	handle_path /* {
		reverse_proxy hp-seerr:5055 {
			header_up Host seerr.labuschagne.xyz
		}
	}
}

auth.labuschagne.xyz {
	import inttls

	handle_path /* {
		reverse_proxy hp-authentik-server:9000
	}
}

ntfy.labuschagne.xyz {
	import inttls

	handle_path /* {
		reverse_proxy hp-ntfy:80
	}
}

dns.labuschagne.xyz {
	import inttls

	handle_path /* {
		reverse_proxy hp-pihole:80
	}
}
